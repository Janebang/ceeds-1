---
title: "Highcharter"
author: "Julia Lee"
date: "3/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(RMySQL)
library(etl)
library(leaflet)
library(RSQLite)
library(ceeds)
library(macleish)
library(lubridate)
library(shinydashboard)
library(shiny)
library(highcharter)
library(timetk)
library(kableExtra)
```

```{r}
# fetching the data from the server
#using read_whately from ceeds package
mac_data <- read_whately()
whately <- purrr::pluck(mac_data, "whately")
orchard <- purrr::pluck(mac_data, "orchard")
```

```{r}
View(whately)
```

```{r}
# Grouping by the date 
daily_whately <- get_daily(whately)
```

```{r}
View(daily_whately)
```


# now putting all of these graphs in shiny dashboard:

```{r}
#setting up the ui of the dashboard
ui <- dashboardPage(
  # making a heading for the dashboard
  dashboardHeader(title = "Macleish weather",                
                  dropdownMenu()),
  #making a sidebar with tabs
  dashboardSidebar(
    # making a sidebar menu
    sidebarMenu(
      #making an id 
      id = "tabs",
      #creating menu items
      menuItem("Current Weather",tabName="Current Weather",icon=icon("globe")),
      menuItem("About", tabName = "About", icon = icon("dashboard")),
      menuItem("Historic Data", tabName = "Historic Data", icon = icon("bar-chart-o")),
      menuItem("Wind",tabName="Wind",icon=icon("globe"))      
    )),
  # Drawing the dashboard body
  dashboardBody(
    # tab items 
    tabItems(
tabItem(tabName = "About", h3("About",align="center"), 
        box(highchartOutput("hc1"), width = 12)),
tabItem(tabName = "Historic Data", h3("Historic Data",align="center"), 
        box(highchartOutput("hc2"), width=12)),
tabItem(tabName = "Wind", h3("Max Wind Speed",align="center") ,                 
        box(highchartOutput("hc3"), width=12))
              )#end tabitems
    )#end body
)

```



```{r}
# shiny server
server <- function(input, output,session){
# defining outputs
# output$name <- name = highchartOutput("name")
  output$hc1 <- renderHighchart ({
    highchart(type = "stock")%>%
      hc_add_series(daily_whately,type = "line", hcaes(y = avgTemp, x = the_date), 
                    name = "Avg temperature") %>%
      hc_add_series(daily_whately,type = "line", hcaes(y = mintemp, x = the_date), 
                    name = "min temperature") %>%
      hc_add_series(daily_whately,type = "line", hcaes(y = maxtemp, x = the_date), 
                    name = "max temperature") %>%
      hc_exporting(enabled = TRUE) # enable exporting option 
    })
  output$hc2 <- renderHighchart({highchart(type = "stock")%>%
      hc_add_series(daily_whately,type = "bar", hcaes(y = precipitation, 
            x = the_date), name = "precipitation") %>%
      hc_exporting(enabled = TRUE)})
  output$hc3 <-renderHighchart({highchart(type = "stock")%>%
      hc_add_series(daily_whately,type = "line", hcaes(y = maxwind, x = the_date)
                    , name = "Max Wind") %>%
      hc_exporting(enabled = TRUE)})

# we want to switch tabs so we need to refresh session
# observeEvent allows reactive input and allows us to switch tabs
  observeEvent(input$switchtab, {
    newtab <- switch(input$tabs, "About" = "Historic Data","Historic Data" 
                     = "About", "About" = "Wind",
                     "Wind" = "About",
                     "Historic Data" = "Wind","Historic Data" = "About",
                     "Current Weather" = "Historic Data", 
                     "Historic Data" = "Current Weather", 
                    "Current Weather" = "About", "About" = "Current Weather",
                     "Wind" = "Current Weather",
                     "Current Weather" = "Wind")
    #update tab items 
    updateTabItems(session, "tabs", newtab)
  })
  
}

```

```{r}
shinyApp(ui, server)
```
